20190824-20200510
codybot is an IRC bot written with the C programming language,
providing users with fortune cookies, jokes, oneliner C compilation, 
shell access and weather per city.

The bot can connect to chat.freenode.net or any specific server using
a specified port or 6697 by default for a SSL connection.

To compile the program, just run 'make' within the source directory
and run with './codybot -n YourNick'. Personally I run the bot in a virtual
machine to limit general system files accesses via the ,sh command. 
Run './codybot --help' to see all program options.

There is no installation mechanism, you should use the source directory
or move the files where you want. The files 'data-ascii.txt', 'data-chars.txt',
'data-fortunes.txt', 'data-jokes.txt' and 'stats' must be in the program's
current working directory otherwise the program will not run.

You should run 'chown -R root data-* Makefile codybot prog-* recomp update src'
so some ',sh rm importantfiles' won't be able to execute... see
https://github.com/cody1632/codybot/security/advisories

You should register and identify your nick with the IRC server's NickServer
(Not available on all IRC networks). You can type '/msg NickServ help'
in your favorite connected IRC client (mIRC, irssi, weechat, hexchat, ...).
Otherwise you can identify by typing 'id yourpasswordhere' or 
'privmsg NickServ :identify pass' in the console when running the codybot
program. Another console-only command you need to run is 
'join #channel_name_here'.

To see available commands, send ',help' in the channel where the bot is.

To trigger a fortune cookie, just type ',fortune' in a channel where the bot
is present, like #codybot. The fortune cookie database file is 
data-fortunes.txt. It's made of concatenation of the linux, computers,
miscellaneous and wisdom files from /usr/share/games/fortunes using my
system-provided fortune package. (see https://github.com/shlomif/fortune-mod)

To get a random joke type ',joke'. This database is hand written using
https://www.funnyshortjokes.com content and is far from containing all
the sites' jokes! There's 25 jokes as of 20200510.

To get weather report from https://wttr.in type ',weather citynamehere'
This should return something like "Montreal: Partly cloudy 23C/73F"

To run a shell command from the chat onto the host of codybot, type
',sh COMMAND ARGS' ie: ',sh ls /home/codybot'. You can disable this
command by touching sh_disable in the program's current directory
as the root user or by using the sudo program. You can also type
'sh_enable/sh_disable' in the console and the same but with the 
trigger char in the channel.

If you want to use the chroot mechanism, you have to download the
minimal chroot archive and extract it in the source directory.
The latest chroot is available @
	https://hobby.esselfe.ca/codybot/chroot.tar.xz
To run all shell commands in a locked chroot, touch './sh_lock' or
type ',sh_lock' or ',sh_unlock'. You have to run as root:
    chroot chroot /bin/bash
    su - dummy
    run.sh
You will have to create 2 fifo pipes since they can't be saved
in the release archive:
	mkfifo chroot/home/dummy/run.{fifo,status}
You should ensure that the codybot user can write to
chroot/home/dummy/run.fifo. The files starting with
"cmd." also need to be owned by the "dummy" user.
Note that the dummy user should exist on both the host
and in the chroot. The UID should match in /etc/passwd
and chroot/etc/passwd

Enjoy!
